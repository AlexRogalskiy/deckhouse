stages:
  - build
  - cleanup

Build:
  stage: build
  script:
    - rvm gemset use dapp-0.26
    - dapp --version
    - dapp dimg bp --tag-ci --verbose ${CI_REGISTRY_IMAGE}
  tags:
    - build

Cleanup:
  stage: cleanup
  script:
    - rvm gemset use dapp-0.26
    - dapp --version
    - dapp dimg cleanup repo ${CI_REGISTRY_IMAGE} --registry-username=registry-cleaner --registry-password=$REGISTRY_CLEANER_TOKEN
    - dapp dimg stages cleanup local
        --improper-cache-version
        --improper-git-commit
        --improper-repo-cache
        ${CI_REGISTRY_IMAGE}
  only:
    - schedules
  tags:
    - build
  retry: 2
