---
title: "Система priority class’ов"
---

Kubernetes предоставляет возможность использовать механизм классов приоритетов ([PriorityClass](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass)), который используется в момент шедулинга новых подов и при наличии дефицита ресурсов в кластере или на отдельном узле:
- по умолчанию (когда `PriorityClass` не используется) новые поды не будут шедулиться;
- при использовании `PriorityClass`, новые поды с более высоким приоритетом будут вытеснять поды, которые имеют меньший приоритет.

Ванильный Kubernetes не предлагает каких-либо готовых или преднастроенных классов приоритетов, а предоставляет только механизм для их создания и использования. 

Данный модуль предлагает для использования в приложениях преднастроенный и стандартизованный набор из классов приоритетов (`PriorityClass`), которые устанавливаются в кластер при включении модуля. Для всех приложений, в том числе пользовательских, если не указано иное, по-умолчанию выставляется базовый (самый низкий) приоритет. 

При включении данного модуля, классы приоритетов также автоматически устанавливаются на уже имеющиеся компоненты кластера, такие как `kube-dns/coredns`, `kube-proxy`, `flannel`, `kube-api-server`, `kube-controller-manager`, `kube-scheduler`, а также на компоненты из модулей Deckhouse. 

Модуль предлагает к использованию следующий набор классов приоритетов:

| Priority          | Priority Class Name  | Значение   |
|---|----|---|
|2000000000|`system-cluster-critical`|Компоненты кластера, без которых его корректная работа полностью невозможна.<br>Используется: `kube-dns`, `coredns`, `kube-proxy`, `flannel`, `kube-api-server`, `kube-controller-manager`, `kube-scheduler`, `cluster-autoscaler`, `dns-controller`.|
|1000000000|`cluster-critical`|Тоже самое, что и system-cluster-critical, но для компонентов которые устанавливаются в отличные от kube-system namespace'ы|
|9000|`production-high`|Stateful приложения, в production-окружении отсутствие которых приводит к полной недоступности сервиса или потере данных. <br>Рекомендуется для использования: `postgresql`, `Memcached`, `Redis`, `mongoDB` и т.п..|
|8000|`cluster-high`|Ключевые компоненты кластера, выход из строя которых влияет на работу всего кластера и приложений.<br>Используется модулем `ingress-nginx`.|
|7000|`cluster-medium`|Компоненты кластера, влияющие на мониторинг (алерты, диагностика) кластера и автоскейлинг. Без мониторинга мы не можем оценить масштабы происшествия, без автоскейлинга мы не сможем дать приложениям необходимые ресурсы.<br>Используется модулями: `deckhouse`, `prometheus`, `kube-state-metrics`, `node-exporter`, `pormetheus-proxy`, `trickster`, `prometheus-metrics-adapter`, `extended-monitoring`, `grafana`|
|6000|`production-medium`|Основные stateless-приложения в production-окружении.
|5000|`deployment-machinery`|Компоненты кластера с помощью которых происходит сборка и деплой приложений в кластер (helm, werf).<br>Используется: kube-system/tiller-deploy|
|4000|`production-low`|Приложения в production-окружении, без работы которых некоторое время возможна работа основных приложений. <br>Пример для использования - кроны и другие подобные периодические вспомогательные процессы, панели управления. Если, например крон нежелательно прерывать, то он должен быть отнесен к production-medium классу.|
|3000|`staging`|Staging окружения для приложений.|
|2000|`cluster-low`|Компоненты кластера, без которых возможна эксплуатация самого кластера, но наличие которых желательно.<br>Примеры: `prometheus-operator`, `node-ping`, `dashboard`, `dashboard-oauth2-proxy`, `cert-manager`, `prometheus-longterm`.|
|1000|`develop` (default)|Класс по умолчанию.<br>Рекомендуется для использования приложениями окружения разработки, динамическими (review) окружениями.|

