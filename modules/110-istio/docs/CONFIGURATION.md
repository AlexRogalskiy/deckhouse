---
title: "Модуль istio: настройки"
---

Модуль по умолчанию **выключен**. Для включения добавьте в ConfigMap `deckhouse`:

```yaml
data:
  openvpnEnabled: "true"
```

## Параметры

* `tlsMode` — режим прозрачного шифрования трафика между pod'ами ([Mutual TLS](https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/)).
    * Возможные значения:
        * `"Off"` — pod'ы не будут шифровать исходящие запросы и не будут отклонять реквесты, которые не зашифрованы. (Hint: пишите "Off" только в кавычках).
        * `"MutualPermissive"` — pod'ы будут шифровать исходящие запросы, но не будут отклонять реквесты, которые не зашифрованы. Режим полезен в переходный момент при переезде на mTLS.
        * `"Mutual"` — pod'ы будут шифровать исходящие запросы и строго будут принимать только зашифрованные реквесты.
    * При включении режима `"Mutual"` перестанут работать классические HTTP-пробы, так как kubelet ничего про mTLS не знает. Но в sidecar c istio предусмотрен специальный порт, куда можно эти пробы направить. Sidecar-injector, который добавляет sidecar-ы в поды, заодно перенаправит ваши пробы на специальный порт.
    * Для шифрования и аутентификации каждый сервис получит собственный индивидуальный ключ, подисанный корневым CA. Этот CA либо генерится при первом запуске модуля, либо указывается явно (см. `ca`).
    * По умолчанию `"Off"`.
    * Управлять режимом mTLS можно локально с помощью ресурсов [AuthorizationPolicy](cr.html#authorizationpolicy) и [DestinationRule](cr.html#destinationrule).
* `ca` — явно заданный корневой сертификат, который будет использован для подписывания индивидуальных сертификатов сервисов в случае включения MTLS (см. `tlsMode`):
    * Формат — строка в формате PEM.
    * `cert` — корневой или промежуточный сертификат.
    * `key` — ключ от сертификата выше.
    * `chain` — цепочка сертификатов на случай  если `cert` — промежуточный сертификат.
    * `root` — корневой сертификат на  случай если `cert` — промежуточный сертификат.
* `sidecar`:
    * `includeOutboundIPRanges` — трафик в сторону этих диапазонов IP насильно заворачивается через Istio.
        * Формат — массив подсетей.
        * По умолчанию — список из Pod CIDR, Service CIDR и адресов нод, собранных с кластера discovery-хуком `cluster_ip_ranges`. То есть, в интернет ходим по-старинке, а локальный трафик контролируем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/includeOutboundIPRanges`.
    * `excludeOutboundIPRanges` — трафик в сторону этих диапазонов IP гарантированно не заворачивается через Istio.
        * Формат — массив подсетей.
        * По умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeOutboundIPRanges`.
    * `excludeInboundPorts` — диапазоны входящих портов, чей трафик гарантированно не заворачивается через Istio.
        * Формат — массив портов.
        * По умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeInboundPorts`.
    * `excludeOutboundPorts` — диапазоны исходящих портов, чей трафик гарантированно не заворачивается через Istio.
        * Формат — массив портов.
        * По умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeOutboundPorts`.
* `federation` — параметры федерации с другими кластерами:
  * `enabled` — обозначить данный кластер как участник федерации (см. [Включение федерации](/modules/110-istio/#включение-федерации)).
  * `ingressGateway` — настройки для ingressgateway:
    * `inlet` — способ публикации ingressgateway, варианты:
      * `LoadBalancer` — рекомендуется в случае, если площадка облачная и поддерживает LB.
      * `NodePort` — для площадок без LB.
      * По умолчанию — `LoadBalancer`.
    * `nodeSelector` — селектор для DaemonSet'а ingressgateway.
      * Формат — стандартный словарь.
    * `tolerations` — для DaemonSet'а ingressgateway.
      * Формат — стандартный массив.
    * `serviceAnnotations` — дополнительные аннотации для сервиса. Полезно, например, для настройки локального LB в Yandex.Cloud (аннотация `yandex.cpi.flant.com/listener-subnet-id`).
      * Формат — стандартный словарь.
* `nodeSelector` — как в Kubernetes в `spec.nodeSelector` у pod'ов.
    * Если ничего не указано — будет [использоваться автоматика](/overview.html#выделение-узлов-под-определенный-вид-нагрузки).
    * Можно указать `false`, чтобы не добавлять никакой nodeSelector.
* `tolerations` — как в Kubernetes в `spec.tolerations` у pod'ов.
    * Если ничего не указано — будет [использоваться автоматика](/overview.html#выделение-узлов-под-определенный-вид-нагрузки).
    * Можно указать `false`, чтобы не добавлять никакие toleration'ы.

Для использования модуля в приложениях, существуют специальные [Custom Resource'ы](cr.html).
