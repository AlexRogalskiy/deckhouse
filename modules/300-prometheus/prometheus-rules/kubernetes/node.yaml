- name: kubernetes.node
  rules:
  - alert: NodeDiskRunningOutOfInodes
    expr: max(predict_linear(node_filesystem_files_free{job="node-exporter"}[6h], 3600 * 24)) BY (node, device, mountpoint, fstype) < 0
    for: 30m
    labels:
      severity: warning
    annotations:
      description: device {{$labels.device}} on node {{$labels.node}} is running
        out of inodes within the next 24 hours (mounted at {{$labels.mountpoint}})
      summary: Node disk is running out of inodes within 24 hours
  - alert: NodeDiskRunningOutOfInodes
    expr: max(predict_linear(node_filesystem_files_free{job="node-exporter"}[30m], 3600 * 2)) BY (node, device, mountpoint, fstype) < 0
    for: 10m
    labels:
      severity: critical
    annotations:
      description: device {{$labels.device}} on node {{$labels.node}} is running
        out of inodes within the next 2 hours (mounted at {{$labels.mountpoint}})
      summary: Node disk is running out of inodes within 2 hours
  - alert: NodePingPacketLoss
    expr: >-
      (
        sum by (destination_node) (increase(kube_node_ping_packets_sent_total[5m]))
        -
        sum by (destination_node) (increase(kube_node_ping_packets_received_total[5m]))
      )
      /
      sum by (destination_node) (increase(kube_node_ping_packets_sent_total[5m]))  > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      description: ICMP packet loss to node {{$labels.destination_node}} is more than 5%
      summary: Ping loss more than 5%
