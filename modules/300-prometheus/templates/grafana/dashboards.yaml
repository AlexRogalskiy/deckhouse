---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: kube-prometheus
{{ include "helm_lib_module_labels" (list . (dict "app" "grafana")) | indent 2 }}
data:
  dashboards.yaml: |+
    apiVersion: 1
    providers:
{{- define "dashboards_yaml_item" }}
{{- $folder := index . 1 }}
    - name: {{ $folder | replace "/" "-" }}
      orgId: 1
      folder: {{ $folder | splitList "/" | first | replace "-" " " | title | quote }}
      type: file
      options:
        path: /grafana-dashboard-definitions/{{ $folder }}
{{- end }}
{{- tuple . "dashboards_yaml_item" | include "for_each_dashboard_folder" }}
    - name: custom
      orgId: 1
      folder: Custom
      type: file
      options:
        path: /grafana-dashboard-definitions/custom
