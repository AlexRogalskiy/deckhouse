apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: kube-prometheus
  labels:
    heritage: antiopa
    module: {{ $.Chart.Name }}
    app: grafana
data:
  prometheus.yaml: |+
    apiVersion: 1
    datasources:
     - name: trickster
       type: prometheus
       access: direct
       orgId: 1
       url: /trickster/main
       version: 1
       isDefault: true
       jsonData:
         timeInterval: 30s
{{- if eq (include "helm_lib_ha_enabled" .) "true" }}
     - name: main-0
       type: prometheus
       access: direct
       url: /prometheus-main-0
       version: 1
       jsonData:
         timeInterval: 30s
     - name: main-1
       type: prometheus
       access: direct
       url: /prometheus-main-1
       version: 1
       jsonData:
         timeInterval: 30s
{{- else }}
     - name: main
       type: prometheus
       access: direct
       orgId: 1
       url: /prometheus
       version: 1
       jsonData:
         timeInterval: 30s
{{- end }}
     - name: trickster-longterm
       type: prometheus
       access: direct
       orgId: 1
       url: /trickster/longterm
       version: 1
       jsonData:
         timeInterval: 300s
     - name: longterm
       type: prometheus
       access: direct
       orgId: 1
       url: /prometheus/longterm
       version: 1
       jsonData:
         timeInterval: 300s
