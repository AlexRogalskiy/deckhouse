{{- define "dashboard_definition" }}
{{- $context := index . 0 }}
{{- $folder := index . 1 }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-definitions-{{ $folder | replace "/" "-" }}
  namespace: d8-monitoring
{{ include "helm_lib_module_labels" (list $context (dict "app" "grafana")) | indent 2 }}
data:
{{ ($context.Files.Glob (print "grafana-dashboards/" $folder "/*.json")).AsConfig | indent 2 }}
{{- end }}
{{- tuple . "dashboard_definition" | include "for_each_dashboard_folder" }}
