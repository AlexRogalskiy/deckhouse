{{- define "dashboard_definition" }}
{{- $context := index . 0 }}
{{- $folder := index . 1 }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-definitions-{{ $folder }}
  namespace: kube-prometheus
  labels:
    heritage: antiopa
    module: {{ $context.Chart.Name }}
    app: grafana
data:
{{ ($context.Files.Glob (print "grafana-dashboards/" $folder "/*.json")).AsConfig | indent 2 }}
{{- end }}
{{- tuple . "dashboard_definition" | include "for_each_dashboard_folder" }}
