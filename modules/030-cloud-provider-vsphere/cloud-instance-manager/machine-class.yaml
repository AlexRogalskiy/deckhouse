apiVersion: machine.sapcloud.io/v1alpha1
kind: VsphereMachineClass
metadata:
  name: {{ .instanceGroup.name }}-{{ printf "%v%v" .Values.global.discovery.clusterUUID .zoneName | sha256sum | trunc 8 }}
  namespace: d8-{{ .Chart.Name }}
{{ include "helm_lib_module_labels" (list .) | indent 2 }}
spec:
  region: {{ .Values.cloudInstanceManager.internal.cloudProvider.vsphere.region | quote }}
  zone:  {{ .zoneName | quote }}
  numCPUs: {{ .instanceGroup.instanceClass.numCPUs }}
  memory: {{ add .instanceGroup.instanceClass.memory (mod .instanceGroup.instanceClass.memory 4) }}
  rootDiskSize: {{ .instanceGroup.instanceClass.rootDiskSize }}
  template: {{ .instanceGroup.instanceClass.template | quote }}
  virtualMachineFolder: {{ .Values.cloudInstanceManager.internal.cloudProvider.vsphere.vmFolderPath | quote }}
  mainNetwork: {{ .instanceGroup.instanceClass.mainNetwork | quote }}
  additionalNetworks:
{{- range .instanceGroup.instanceClass.additionalNetworks }}
  - {{ . | quote }}
{{- end }}
  datastore: {{ .instanceGroup.instanceClass.datastore | quote }}
  clusterNameTag: {{ .Values.global.discovery.clusterUUID }}
  nodeRoleTag: {{ .instanceGroup.name }}-{{ .zoneName }}
  sshKeys:
{{- range .Values.cloudInstanceManager.internal.cloudProvider.vsphere.sshKeys }}
  - {{ . | quote }}
{{- end }}
  secretRef:
    namespace: d8-{{ .Chart.Name }}
    name: {{ .instanceGroup.name }}-{{ printf "%v%v" .Values.global.discovery.clusterUUID .zoneName | sha256sum | trunc 8 }}
