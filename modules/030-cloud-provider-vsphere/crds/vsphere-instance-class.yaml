apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: vsphereinstanceclasses.deckhouse.io
  labels:
    heritage: deckhouse
    module: cloud-provider-vsphere
spec:
  group: deckhouse.io
  versions:
    - name: v1alpha1
      served: true
      storage: true
  scope: Cluster
  names:
    plural: vsphereinstanceclasses
    singular: vsphereinstanceclass
    kind: VsphereInstanceClass
    categories:
    - cloudinstanceclasses
  validation:
    openAPIV3Schema:
      type: object
      description: VsphereInstanceClass defines vSphere-specific properties for to-be-provisioned Instances.
      required:
      - spec
      properties:
        spec:
          type: object
          required:
          - numCPUs
          - memory
          - rootDiskSize
          - template
          - mainNetwork
          - datastore
          properties:
            numCPUs:
              description: Count of vCPUs to allocate to vSphere VirtualMachines.
              example: 2
              type: integer
            memory:
              description: Memory in MiB to allocate to vSphere VirtualMachines.
              example: 8192
              type: integer
            rootDiskSize:
              description: Root disk size in GiB to use in vSphere VirtualMachines.
              example: 20
              type: integer
            template:
              description: Path to the template to be cloned. Relative to the datacenter.
              example: dev/golden_image
              type: string
            mainNetwork:
              description: Path to the network that VirtualMachines' primary NICs will connect to. Relative to the datacenter.
              example: k8s-msk-178
              type: string
            additionalNetworks:
              description: Paths to networks that VirtualMachines' secondary NICs will connect to. Relative to the datacenter.
              example:
              - DEVOPS_32
              - DEVOPS_50
              type: array
              items:
                type: string
            datastore:
              description: Path to a datastore in which VirtualMachines will be cloned. Relative to the datacenter.
              example: lun-1201
              type: string
            resourcePool:
              description: Path to a Resource Pool in which VirtualMachines will be cloned. Relative to the zone (vSphere Cluster).
              example: rp-2012
              type: string
            resourcePoolForNewNodes:
              description: Path to a Resource Pool in which VirtualMachines will be cloned. Relative to the zone (vSphere Cluster). Identical to the "resourcePool", but won't rollout new nodes
              example: rp-2012
              type: string
            runtimeOptions:
              type: object
              properties:
                nestedHardwareVirtualization:
                  description: Whether to enable or disable nested hardware virtualization.
                  type: boolean
                cpuShares:
                  type: integer
                cpuLimit:
                  description: CPU limit in MHz.
                  type: integer
                cpuReservation:
                  description: CPU reservation in MHz.
                  type: integer
                memoryShares:
                  type: integer
                memoryLimit:
                  description: Memory limit in MB.
                  type: integer
                memoryReservation:
                  description: VM memory reservation in percent.
                  type: integer
                  minimum: 0
                  maximum: 100
            bashible:
              type: object
              required:
              - bundle
              properties:
                bundle:
                  description: The name of one of bashible bundles.
                  example: "ubuntu-18.04-1.0"
                  type: string
                options:
                  description: "Options to pass to bundle during the bootstrap stage. Vary between different bundles"
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                dynamicOptions:
                  description: "Options to pass to bundle during the main stage. Vary between different bundles"
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
