{{- range $ds := .Values.cloudProviderVsphere.internal.datastores }}
---
kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: {{ $ds.name }}
  {{- if $.Values.cloudProviderVsphere.defaultDatastore }}
    {{- if $ds.path | hasSuffix $.Values.cloudProviderVsphere.defaultDatastore }}
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
    {{- end }}
  {{- end }}
{{ include "helm_lib_module_labels" (list $) | indent 2 }}
provisioner: vsphere.csi.vmware.com
volumeBindingMode: Immediate
allowVolumeExpansion: true
parameters:
  parent_type: {{ $ds.datastoreType | quote }}
  parent_name: {{ $ds.path | quote }}
allowedTopologies:
- matchLabelExpressions:
  - key: failure-domain.beta.kubernetes.io/region
    values:
    - {{ $.Values.cloudProviderVsphere.internal.region }}
  - key: failure-domain.beta.kubernetes.io/zone
    values:
  {{- range $ds.zones}}
    - {{ . }}
  {{- end }}
{{- end }}
