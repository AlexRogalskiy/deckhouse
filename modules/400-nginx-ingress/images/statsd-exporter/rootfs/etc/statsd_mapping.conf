mappings:
########################################################################################################################
# General mapping is:
# ```
# name:value|type
# ```
# We use many labels, concateneted in name using # symbol, for example:
# ```
# a#http#kube-nginx-ingress#test.k8s.dev.someproject.ru#404:1|c
# ```
# First letter's explanation can be found in `modules/400-nginx-ingress/files/lua/statsd.lua` call() method
#####
# Examples of label values:
#   namespace             pult-production / kube-nginx-ingress
#   scheme                http
#   server_name           api.someproject.somedomain / api.someproject.somedomain / test.k8s.dev.someproject.ru
#   ingress_name          test / pult-servers-api
#   backend_service       pult-servers-api-web default-http-backend
#   service_port          80
#   location_path         /
#   endpoint_ip           10.244.2.250
#   status                200 / 404
########################################################################################################################

# a#http#kube-nginx-ingress#test.k8s.dev.someproject.ru#404:1|c
- match: ^a#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_overall_responses_total"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"
    status: "$4"

# b#kube-nginx-ingress#test#404:1|c
- match: ^b#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_namespace_responses_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    status: "$3"

# c#kube-nginx-ingress#test#default-http-backend#80#404:1|c
- match: ^c#([^#]+)#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_service_responses_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    service_name: "$3"
    service_port: "$4"
    status: "$5"

# d#test.k8s.dev.someproject.ru#/#404:1|c
- match: ^d#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_server_responses_total"
  labels:
    server_name: "$1"
    location_path: "$2"
    status: "$3"

# s#kube-nginx-ingress#test#default-http-backend#80#10.244.2.100#404:1|c
# s#kube-nginx-ingress#foo#default-http-backend#80#10.244.2.110#404:1|c
- match: ^s#([^#]+)#([^#]+)#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_service_backend_responses_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    service_name: "$3"
    service_port: "$4"
    endpoint_ip: "$5"
    status: "$6"

# t#test.k8s.dev.someproject.ru#/#10.244.2.100#404:1|c
- match: ^t#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_server_backend_responses_total"
  labels:
    server_name: "$1"
    location_path: "$2"
    endpoint_ip: "$3"
    status: "$4"

########################################################################################################################
# ingress_nginx_overall_request_seconds_{sum,count,bucket}

# e#http#pult-production#api.someproject.somedomain:60|h
# e#http#kube-nginx-ingress#test.k8s.dev.someproject.ru:1|h
- match: ^e#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_overall_request_seconds"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# f#pult-production#pult-servers-api:60|h
# f#kube-nginx-ingress#test:1|h
- match: ^f#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_namespace_request_seconds"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# g#pult-production#pult-servers-api#pult-servers-api-web#80:60|h
# g#kube-nginx-ingress#test#default-http-backend#80:1|h
- match: ^g#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_service_request_seconds"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# h#api.someproject.somedomain#/:60|h
# h#test.k8s.dev.someproject.ru#/:1|h
- match: ^h#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_server_request_seconds"
  labels:
    server_name: "$1"
    location_path: "$2"

########################################################################################################################
# ingress_nginx_overall_sent_bytes_{....}

# i#http#pult-production#api.someproject.somedomain:37098000|h
# i#http#kube-nginx-ingress#test.k8s.dev.someproject.ru:169000|h
- match: ^i#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_overall_sent_bytes"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# j#pult-production#pult-servers-api:37098000|h
# j#kube-nginx-ingress#test:169000|h
- match: ^j#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_namespace_sent_bytes"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# k#pult-production#pult-servers-api#pult-servers-api-web#80:37098000|h
# k#kube-nginx-ingress#test#default-http-backend#80:169000|h
- match: ^k#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_service_sent_bytes"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# l#api.someproject.somedomain#/:37098000|h
# l#test.k8s.dev.someproject.ru#/:169000|h
- match: ^l#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_server_sent_bytes"
  labels:
    server_name: "$1"
    location_path: "$2"

########################################################################################################################
# ingress_nginx_overall_received_bytes_{....}

# m#http#pult-production#api.someproject.somedomain:37098000|h
# m#http#kube-nginx-ingress#test.k8s.dev.someproject.ru:169000|h
- match: ^m#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_overall_received_bytes"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# n#pult-production#pult-servers-api:37098000|h
# n#kube-nginx-ingress#test:169000|h
- match: ^n#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_namespace_received_bytes"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# o#pult-production#pult-servers-api#pult-servers-api-web#80:37098000|h
# o#kube-nginx-ingress#test#default-http-backend#80:169000|h
- match: ^o#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_service_received_bytes"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# p#api.someproject.somedomain#/:37098000|h
# p#test.k8s.dev.someproject.ru#/:169000|h
- match: ^p#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 100, 1024, 10240, 102400, 1048576, 10485760, 104857600, 1073741824, 10737418240 ]
  name: "ingress_nginx_server_received_bytes"
  labels:
    server_name: "$1"
    location_path: "$2"

########################################################################################################################
# ingress_nginx_overall_response_seconds_{...}

# u#http#pult-production#api.someproject.somedomain:52|h
# u#http#kube-nginx-ingress#test.k8s.dev.someproject.ru:0|h
- match: ^u#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_overall_response_seconds"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# v#pult-production#pult-servers-api:52|h
# v#kube-nginx-ingress#test:0|h
- match: ^v#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_namespace_response_seconds"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# q#pult-production#pult-servers-api#pult-servers-api-web#80#10.244.2.250:52|h
# q#kube-nginx-ingress#test#default-http-backend#80#10.244.2.100:0|h
- match: ^q#([^#]+)#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_service_backend_response_seconds"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    service_name: "$3"
    service_port: "$4"
    endpoint_ip: "$5"

# w#pult-production#pult-servers-api#pult-servers-api-web#80:52|h
# w#kube-nginx-ingress#test#default-http-backend#80:0|h
- match: ^w#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_service_response_seconds"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# x#api.someproject.somedomain#/:52|h
# x#test.k8s.dev.someproject.ru#/:0|h
- match: ^x#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_server_response_seconds"
  labels:
    server_name: "$1"
    location_path: "$2"

# r#api.someproject.somedomain#/#10.244.2.250:52|h
# r#test.k8s.dev.someproject.ru#/#10.244.2.100:0|h
- match: ^r#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  timer_type: histogram
  buckets: [ 0.005, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2, 3, 4, 5, 10 ]
  name: "ingress_nginx_server_backend_response_seconds"
  labels:
    server_name: "$1"
    location_path: "$2"
    endpoint_ip: "$3"

########################################################################################################################

# ingress_nginx_overall_upstream_retries_total

# y#http#pult-production#api.someproject.somedomain:1|c
# y#http#kube-nginx-ingress#test.k8s.dev.someproject.ru:1|c
- match: ^y#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_overall_upstream_retries_total"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# z#pult-production#pult-servers-api:1|c
# z#kube-nginx-ingress#test:1|c
- match: ^z#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_namespace_upstream_retries_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# 0#pult-production#pult-servers-api#pult-servers-api-web#80:1|c
- match: ^0#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_service_upstream_retries_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# 1#api.someproject.somedomain#/:1|c
- match: ^1#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_server_upstream_retries_total"
  labels:
    server_name: "$1"
    location_path: "$2"

########################################################################################################################
# ingress_nginx_overall_upstream_redirects_total

# 2#http#pult-production#api.someproject.somedomain:0|c
- match: ^2#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_overall_upstream_redirects_total"
  labels:
    scheme: "$1"
    namespace: "$2"
    server_name: "$3"

# 3#pult-production#pult-servers-api:0|c
- match: ^3#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_namespace_upstream_redirects_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"

# 4#pult-production#pult-servers-api#pult-servers-api-web#80:0|c
- match: ^4#([^#]+)#([^#]+)#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_service_upstream_redirects_total"
  labels:
    namespace: "$1"
    ingress_name: "$2"
    backend_service: "$3"
    service_port: "$4"

# 5#api.someproject.somedomain#/:0|c
- match: ^5#([^#]+)#([^#]+)$
  match_type: regex
  name: "ingress_nginx_server_upstream_redirects_total"
  labels:
    server_name: "$1"
    location_path: "$2"

########################################################################################################################

- match: .
  match_type: regex
  action: drop
  name: "dropped"
