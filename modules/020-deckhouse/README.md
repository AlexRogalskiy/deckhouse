Модуль deckhouse
================

Модуль не устанавливает, но настраивает Deckhouse.

Конфигурация
------------

### Что нужно настроить?

Ничего!

### Параметры

* `logLevel` — уровень логирования Deckhouse: `Debug`, `Info` или `Error`. По-умолчанию `Info`.
* `bundle` —  вариант поставки Deckhouse. Определяет включенные по умолчанию модули. Возможные варианты параметра bundle и какие модули они в себя включают:
    * `Default` *(выбран по умолчанию)* — включает в себя все необходимые для полноценной работы кластера модули;
    * `Minimal` — включает модули, необходимые для минимального функционирования Deckhouse в кластере.
* `releaseChannel` — канал обновлений Deckhouse.  
Возможные варианты в порядке возрастания стабильности обновлений: `Alpha`, `Beta`, `RC`, `Stable` или `RockSolid`. 
### Пример конфига

```yaml
deckhouse: |
  logLevel: Debug
  bundle: Minimal
  releaseChannel: RockSolid
```

Автоматическая стабилизация релизного канала
--------------------------------------------
При указании в конфигурации параметра `releaseChannel` Deckhouse каждые 10 минут будет запускать скрипт стабилизации канала обновлений, который будет действовать по следующей логике:
* Если указанный канал обновлений соотвествует тегу docker образа Deckhouse - ничего не произойдет;

* При смене канала обновлений на более стабильный (например с Alpha на RC) будет произведен плавный переход.
  
  Сначала мы проверяем равенство [digest](https://success.docker.com/article/images-tagging-vs-digests) для тегов docker образов, соотвествующих текущему каналу обновлений и ближайшему к нему более стабильному (в нашем примере это каналы Alpha и Beta).
  
  Если digest'ы равны, будет проверен следующий по очереди тег (в нашем примере соответствующий каналу обновлений RC).
  
  В итоге Deckhouse будет переключен на более стабильный канал обновлений c digest'ом, равным текущему.

* Если указан менее стабильный канал обновлений, чем тот, который соотвествует текущему тегу docker образа Deckhouse - мы сверим digest'ы соотвествующие образам docker для текущего канала обновлений  и следующего менее стабильного (например хотим перейти на Alpha, сейчас мы на RC, сравнивать будем RC и Beta).

  Если digest не равны, Deckhouse будет переключен на следующий канал обновлений (в нашем случае на Beta). Это необходимо, чтобы не пропустить важные миграции, которые мы проводим при обновлении Deckhouse.
  
  Если digest равны, будет проверен следующий по убыванию стабильности канал обновлений (в нашем случае Alpha).
  
  Когда проверка дойдет до желаемого канал обновлений (в примере Alpha), переключение Deckhouse произойдет не зависимо от равенства digest.
  
  
В итоге постоянный запуск скрипта стабилизации рано или поздно приведет Deckhouse к состоянию соотвествия тега его docker образа и канала обновлений.
 
