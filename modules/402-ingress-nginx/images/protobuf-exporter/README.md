protobuf_exporter
=================
Принимает сообщения в формате protobuf, разбирает. сохраняет метрики во внутреннее хранилище и экспортирует их в формате Prometheus.

### Mappings:
Маппинги - описанные шаблоны для метрик. Маппинг сообщений производится на основе индексов.
* `type` - тип метрики (возможны Histogram, Counter, Gauge).
* `name` - имя метрики.
* `help` - описание метрик.
* `ttl` - тамаут на хранение метрики (если нет новых записей, метрика будет удалена по таймауту). При указании `0` таймаут отсутствует.
* `labels` - массив ключей для лейблов метрики.
* `bucket` - массив бакетов для Histogram метрики (необходимо для преобразования в формат Prometheus).

### Типы сообщений:
1. `CounterMessage` - сообщение для подсчета counter'ов.
    * `MappingIndex` - индекс маппинга, к которому относится данная метрика
    * `Labels` - значения для лейблов метрики
    * `Value` - значение метрики в формате uint64
2. `GaugeMessage` - сообщение для подсчета gauge'ов.
    * `MappingIndex` - индекс маппинга, к которому относится данная метрика
    * `Labels` - значения для лейблов метрики
    * `Value` - значение метрики в формате float64    
2. `HistogramMessage` - сообщение для подсчета histogram. Ключевое отличие от стандартного формата prometheus_client заключается в том, что вместо передачи значения для расчета гистограммы мы принимаем уже промежуточно посчитанные значения. Это позволяет снизить нагрузку на io и cpu за счет предварительной агрегации данных на стороне клиента. 
    * `MappingIndex` - индекс маппинга, к которому относится данная метрика
    * `Labels` - значения для лейблов метрики
    * `Sum` - сумма значений метрики в формате float64
    * `Count` - общее количество принятых метрик в формате uint64
    * `Buckets` - карта распределения значений по бакетам в формате map[string]uint64. В отличие от Prometheus значение должно быть отмечено только в первом бакете, в который оно попало. Это также помогает снизить количество данных при передаче.

### Протокол:
Сообщение состоит из трех частей:
1. Первый байт - маркер того, какое protobuf-сообщение мы будем принимать.
    * `1` - HistogramMessage
    * `2` - GaugeMessage
    * `3` - CounterMessage
2. Длина сообщения - закодированное в виде байт uint64 значение.
3. Сообщение в формате protobuf.  
