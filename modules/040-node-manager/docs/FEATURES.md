---
title: "Управление нодами"
---

Deckhouse позволяет в автоматическом режиме производить управление и конфигурирование узлов Kubernetes, в том числе:
- Группировка нод и управление группами
- Автоматическое развертывание, настройка и обновление нод Kubernetes
- Заказ нод в поддерживаемых облаках
- Автомасштабирование нод в поддерживаемых облаках
- Chaos monkey

## Поддерживаемые платформы
Deckhouse может быть развернут в следующих вариантах:

### Cloud
Это вариант инсталляции в поддерживаемых облачных провайдерах:
- Amazon Web Services (AWS)
- Google Cloud Platform
- Yandex Cloud
- OpenStack
- VMware vSphere

Если ваш облачный провайдер не поддерживается, вы все равно можете использовать Deckhouse в варианте [bare metal](#bare-metal).

### Managed kubernetes
Deckhouse также может быть развернут в managed Kubernetes ряда провайдеров:
- Google Kubernetes Engine(GKE)
- Amazon Elastic Kubernetes Service (EKS)
На данный момент, *не весь функционал Deckhouse доступен в случае такой инсталляции.*

### Bare Metal
Deckhouse поддерживает работу и при развертывании на *“голом железе”* или вручную созданных виртуальных машинах.

### Группировка нод и управление группами
Модуль [node-manager]({{site.baseurl}}/modules/040-node-manager/) позволяет группировать узлы и управлять ими как связанной группой (custom resource `NodeGroup`). Это означает, что все узлы группы будут иметь одинаковые метаданные, взятые из custom resource `NodeGroup` из полей `labels`, `annotation` или `taints`.
Пример [NodeGroup]({{site.baseurl}}/modules/040-node-manager/#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-nodegroup).
При определении NodeGroup требуется указание типа узлов, которые используются в группе. Доступны следующие типы:
- `Cloud` – узлы для этой группы будут автоматически создаваться (и удаляться) в поддерживаемых облаках
- `Static` – статический узел, размещенный на железном сервере или виртуальной машине. Узел не управляется `cloud-controller-manager`, даже если включен один из облачных провайдеров.
- `Hybrid` – статический узел (созданный вручную или любыми внешними инструментами), размещенный в том же облаке, с которым настроена интеграция у одного из облачных провайдеров, на таком узле работает CSI и такой узел управляется `cloud-controller-manager` (объект *Node* автоматически обогащается информацией о зоне и регионе по данным, полученным от облака; при удалении узла из облака, соответствующий ему *Node*-объект будет удален в Kubernetes). Подробности доступны в [документации]({{site.baseurl}}/modules/040-node-manager).

Для узлов, объединенных в группу доступен мониторинг группы:
- Группировка параметров узлов на графиках группы;
- Автоматическая группировка алертов из о недоступности узлов;
- Алерты о недоступности N или N% узлов группы и т.п.;

### Автоматическое развертывание, настройка и обновление нод Kubernetes
#### Поддерживаемые платформы и версии Kubernetes
Автоматическое развертывание (в *static/hybrid* – частично), настройка и дальнейшее обновление ПО работает на любых кластерах, независимо от его размещения в облаке или на `bare-metal`.

Поддерживаемая версия Kubernetes указывается в параметрах с точностью до минорной версии. Если версия не будет указана, то модуль `node-manager` будет использовать версию, указанную в параметрах `control-plane`.

#### Развертывание узлов Kubernetes
Deckhouse автоматически развертывает узлы кластера, выполняя следующие **идемпотентные** операции:
- Операционная система (это может быть Ubuntu 18.04 или CentOS 7) оптимизируется для работы с Docker и Kubernetes:
  - Устанавливается протестированная и проверенная версия ядра;
  - Устанавливаются требуемые пакеты из репозиториев дистрибутива;
  - Настраиваются параметры работы ядра, iptables, параметры журналирования, ротация журналов и другие параметры системы.
- Docker и Kubernetes: Deckhouse устанавливает требуемую версию Docker и Kubelet и включает ноду в кластер Kubernetes.
- Настраивается Nginx и автоматическая система обновления перечня upstream’ов для балансировки запросов от узла к Kubernetes API.

#### Поддержка актуального состояния узлов
Deckhouse с помощью модуля node-manager будет стремиться к поддержанию узлов кластера в актуальном состоянии в пределах [указанной](#поддерживаемые-платформы-и-версии-kubernetes) в настройках минорной версии Kubernetes. Системой автоматического обновления поддерживается два типа обновлений:
обычные – всегда происходят автоматически, не приводят к остановке или перезагрузке ноды;
требующие прерывания (disruption) - например, обновление ядра, смена версии Docker, значительная смена версии kubelet и т.д. Для этого типа обновлений можно выбрать ручной или автоматический режим. В автоматическом режиме перед обновлением выполняется корректная приостановка работы ноды (drain) и только после этого выполняется обновление.

В случаях, когда используется группировка узлов, производится одновременное обновление только одного узла из группы, и только когда все узлы группы доступны.
Модуль имеет набор встроенных метрик мониторинга, которые позволяют контролировать прогресс обновления, получать уведомления о возникающих во время обновления проблемах или о необходимости принятия решения о продолжении человеком.

### Заказ нод в поддерживаемых облаках
В [поддерживаемых облаках]() существует возможность автоматического заказа нод. Необходимо просто указать требуемые параметры для каждой ноды или для группы нод.

В зависимости от облака этими параметрами могут быть:
- тип ноды или количество ядер процессора и объем оперативной памяти
- размер диска
- настройки безопасности
- подключаемые сети
- другое...

Создание, запуск и подключение виртуальных машин к кластеру выполняется в полностью автоматическом режиме.

### Автомасштабирование нод в поддерживаемых облаках
Когда для заказа нод используется группа, существует два варианта указания количества узлов в группе:
- Фиксированное количество узлов. В этом случае Deckhouse будет поддерживать указанное количество узлов, например, заказывая новые в случае выхода из строя старых нод.
- Диапазон в виде минимального и максимального значения количества нод. Указание диапазона включает автомасштабирование узлов кластера (node autoscaler), который срабатывает при дефиците ресурсов и состоянии pending у подов.

### Chaos monkey
Это инструмент (включается у каждой из `NodeGroup` отдельно), позволяющий систематически вызывать случайные прерывания работы узлов, таким образом проверяя, что все элементы кластера, приложение и требуемые для его работы инфраструктурные компоненты обладают достаточным уровнем избыточности и отказоустойчивости.
