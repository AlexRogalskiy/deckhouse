{{- range $bundle := $.Values.nodeManager.allowedBundles }}
  {{- range $ng := $.Values.nodeManager.internal.nodeGroups }}
---
apiVersion: v1
kind: Secret
metadata:
  name: bashible-bundle-{{ $bundle }}-{{ $ng.name }}
  namespace: d8-cloud-instance-manager
{{ include "helm_lib_module_labels" (list $) | indent 2 }}
type: Opaque
data:
{{- include "bundles_rendered_steps_node_group" (list $ $bundle $ng) | indent 2 -}}
  {{- end }}

  {{- range $kubernetes_version :=  $.Values.nodeManager.allowedKubernetesVersions }}
---
apiVersion: v1
kind: Secret
metadata:
  name: bashible-bundle-{{ $bundle }}-{{ $kubernetes_version }}
  namespace: d8-cloud-instance-manager
{{ include "helm_lib_module_labels" (list $) | indent 2 }}
type: Opaque
data:
{{- include "bundles_rendered_steps_all" (list $ $bundle $kubernetes_version) | indent 2 -}}
  {{- end }}
{{- end }}
