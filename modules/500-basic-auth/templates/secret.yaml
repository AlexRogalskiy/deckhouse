---
apiVersion: v1
kind: Secret
metadata:
  name: htpasswd
  namespace: kube-{{ .Chart.Name }}
  labels:
    heritage: antiopa
    module: {{ .Chart.Name }}
    app: {{ .Chart.Name }}
data:
{{- range $location := .Values.basicAuth.locations }}
  {{- if eq $location.location "/" }}
  {{ printf "htpasswd: |\n" }}
    {{- include "users" $location | b64enc | indent 4 }}
  {{- else }}

  {{ $location.location | trimPrefix "/" | printf "%s: |\n"  }}
    {{- include "users" $location | b64enc | indent 4 }}
  {{- end }}
{{- end }}
