#!/bin/bash

source /deckhouse/shell_lib.sh

function __config__() {
  jo -p beforeHelm=1
}

function __main__() {
  if kubectl -n d8-system get configmap deckhouse -o json | jq '.data.pingExporter' -e >/dev/null 2>/dev/null ; then
    old_config=$(kubectl -n d8-system get configmap deckhouse -o json | jq '.data.pingExporter' -r | yq r -j -)
    values::set --config monitoringPing "${old_config}"
    values::unset --config pingExporter
  fi
}

hook::run "$@"
