---
artifact: candictl
from: golang:1.13-alpine3.11
git:
- add: /candictl
  to: /candictl
  stageDependencies:
    install:
    - go.mod
    - go.sum
    setup:
    - "**/*.go"
    - go-build.sh
ansible:
  beforeInstall:
  - apk:
      name: git,ca-certificates
      update_cache: yes
  - command: rm -rf /var/cache/apk/*

  install:
  - shell: go mod download
    args:
      chdir: /candictl

  setup:
  - command: /candictl/go-build.sh
    args:
      chdir: /candictl
---
image: {{ .ModuleName }}/{{ .ImageName }}
from: alpine:3.11
docker:
  ENTRYPOINT: ["candictl"]
import:
- artifact: candictl
  add: /candictl/candictl
  to: /usr/bin/candictl
  before: setup
git:
- add: /
  to: /deckhouse
  includePaths:
  - candi
ansible:
  install:
  - name: "Install terraform"
    unarchive:
      src: https://releases.hashicorp.com/terraform/0.13.2/terraform_0.13.2_linux_amd64.zip
      remote_src: yes
      dest: /bin
      mode: +x
  - command: rm -rf /var/cache/apk/*
