Модуль sysctl-tuner
===================

## Назначение

Тюнинг параметров системы (таких как `sysctl`) на всех нодах кластера.

Модуль устанавливает наиболее безопасные и общие параметры, согласованные внутри компании.

## Конфигурация

### Параметры

* `conntrackMaxPerCore` после умножения этого значения на количество ядер ноды получаем `nf_conntrack_max`, но не применяем его пока не обработаем параметр ниже.
  * По-умолчанию: 131072
* `conntrackMin` если это значение окажется больше полученного выше `nf_conntrack_max`, то применяется оно.
  * По-умолчанию: 524288

Далее, получив `nf_conntrack_max`, модуль настраивает hashsize по формуле `nf_conntrack_max` / 4.

### Как отключить

По умолчанию модуль **включен**.

Добавить в ConfigMap Antiopa:
```yaml
sysctlTuner: "false"
```

## Как работает

Каждые 5 минут записывает необходимые параметры в `/proc/sys` и `/sys`.

Устанавливаемые параметры заданы статически в [DaemonSet](modules/700-sysctl-tuner/templates/daemon-set.yaml). Таким образом, если вручную изменить какое-либо значение параметра, которое отслеживает `sysctl`, то он переопределит его не позднее чем через 5 минут.

## Что делать если нужно добавить или изменить параметр

- Вариант 1 — [отключить](#как-отключить) модуль
- Вариант 2 — [создать Issue](https://github.com/deckhouse/deckhouse/issues/new?issue%5Btitle%5D=%5Bsysctl-tuner%5D) с описанием вашей потребности (возможно есть смысл изменить настройки во всех кластерах)
