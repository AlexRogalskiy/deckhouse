{{- if not .Values.istio.disableMixerTelemetry }}
---
apiVersion: v1
kind: Service
metadata:
  name: istio-telemetry
  namespace: d8-{{ .Chart.Name }}
  annotations:
    networking.istio.io/exportTo: "*"
{{ include "helm_lib_module_labels" (list . (dict "app" "mixer-telemetry" "prometheus.deckhouse.io/target" "istio-mixer" "prometheus.deckhouse.io/target" "istio-mixer-telemetry")) | indent 2 }}
spec:
  ports:
  - name: grpc-mixer
    port: 9091
  - name: grpc-mixer-mtls
    port: 15004
  - name: http-metrics
    port: 15014
  - name: http-telemetry-metrics
    port: 42422
  selector:
    app: mixer-telemetry
{{- end }} {{- /* if not .Values.istio.disableMixerTelemetry */ -}}
