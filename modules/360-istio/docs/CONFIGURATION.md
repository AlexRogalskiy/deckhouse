---
title: "Модуль istio: настройки"
---

## Параметры

* `tlsMode` — режим прозрачного шифрования трафика между pod'ами ([Mutual TLS](https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/)).e
    * Возможные значения:
        * `"Off"` — pod'ы не будут шифровать исходящие запросы и не будут отклонять реквесты, которые не зашифрованы. (Hint: пишите "Off" только в кавычках).
        * `"MutualPermissive"` — pod'ы будут шифровать исходящие запросы, но не будут отклонять реквесты, которые не зашифрованы. Режим полезен в переходный момент при переезде на mTLS.
        * `"Mutual"` — pod'ы будут шифровать исходящие запросы и строго будут принимать только зашифрованные реквесты.
    * При включении режима `"Mutual"` перестанут работать классические HTTP-пробы, так как kubelet ничего про mTLS не знает. Но в sidecar c istio предусмотрен специальный порт, куда можно эти пробы направить. Sidecar-injector, который добавляет sidecar-ы в поды, заодно перенаправит ваши пробы на специальный порт.
    * По-умолчанию `"Off"`.
    * Управлять режимом mTLS можно локально с помощью ресурсов [Policy](cr.html#policy) и [DestinationRule](cr.html#destinationrule).
* `disableMixerTelemetry` — выключить компонент Mixer и сбор [телеметрии](https://istio.io/latest/docs/concepts/observability/). Деплоймент mixer-telemetry будет получать от сайдкаров метрики и агрегировать их для экспорта в Prometheus. Может повлиять на производительность сайдкаров.
    * По-умолчанию `false`.
* `enableAuthorizationGlobally` — включить режим [нативной авторизации](cr.html#native-авторизация) средствами istio-proxy "что не разрешено, то запрещено".
    * **Важно!** Авторизация без mTLS-аутентификации не будет работать в полной мере. В этом случае будут доступны только простейшие аргументы для составления политик, такие как source.ip и request.headers.
    * При включении авторизации перестанут работать классические HTTP-пробы, так как разрешающих правил для проб никто не сделал. Но в sidecar c istio предусмотрен специальный порт, куда можно эти пробы направить. Sidecar-injector, который добавляет sidecar-ы в поды, заодно перенаправит ваши пробы на специальный порт.
    * Авторизацию также можно включать локально, для namespace или для единственного сервиса с помощью ресурса [RbacConfig](cr.html#rbacconfig).
    * По-умолчанию `false`.
* `sidecarInjectorPolicy` — определяет поведение sidecar-injector-а после того, как его натравили на прикладной namespace (см. [Как активировать istio для моего приложения?](/modules/360-istio/#как-активировать-istio-для-приложения)).
    * Возможные значения — `enabled` (вставлять sidecar в новые поды) или `disabled` (не вставлять sidecar в новые поды). Переопределить поведение можно аннотацией к поду `sidecar.istio.io/inject`.
    * По-умолчанию — `enabled`.
* `sidecar`:
    * `includeOutboundIPRanges` — трафик в сторону этих диапазонов IP насильно заворачивается через istio.
        * Формат — массив подсетей или `["*"]`.
        * По-умолчанию — список из Pod CIDR, Service CIDR и адресов нод, собранных с кластера discovery-хуком `cluster_ip_ranges`. То есть, в интернет ходим по-старинке, а локальный трафик контролируем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/includeOutboundIPRanges`.
    * `excludeOutboundIPRanges` — трафик в сторону этих диапазонов IP гарантированно не заворачивается через istio.
        * Формат — массив подсетей или `["*"]`.
        * По-умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeOutboundIPRanges`.
    * `excludeInboundPorts` — диапазоны входящих портов, чей трафик гарантированно не заворачивается через istio.
        * Формат — массив портов или `["*"]`.
        * По-умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeInboundPorts`.
    * `excludeOutboundPorts` — диапазоны исходящих портов, чей трафик гарантированно не заворачивается через istio.
        * Формат — массив портов или `["*"]`.
        * По-умолчанию `[]`. То есть, исключений не делаем.
        * Можно локально переопределить аннотацией `traffic.sidecar.istio.io/excludeOutboundPorts`.
    * `zipkinAddress` — адрес сервиса, который готов принять трейсы в формате Zipkin. Это может быть либо инсталляция zipkin, либо jaeger collector (Envoy, на котором основан Istio не умеет слать трейсы по правильному протоколу в jaeger agent, только zipkin). см. [Трассировка](/modules/360-istio/#трассировка).
        * Формат — `адрес:порт` (например, `jaeger.kube-jaeger:9411`).
        * По-умолчанию `false`.
* `nodeSelector` — как в Kubernetes в `spec.nodeSelector` у pod'ов.
    * Если ничего не указано — будет [использоваться автоматика](/overview.html#выделение-узлов-под-определенный-вид-нагрузки).
    * Можно указать `false`, чтобы не добавлять никакой nodeSelector.
* `tolerations` — как в Kubernetes в `spec.tolerations` у pod'ов.
    * Если ничего не указано — будет [использоваться автоматика](/overview.html#выделение-узлов-под-определенный-вид-нагрузки).
    * Можно указать `false`, чтобы не добавлять никакие toleration'ы.

Для использования модуля в приложениях, существуют специальные [Custom Resource'ы](cr.html).