{{- if .Values.cloudProviderOpenstack.networkName }}
---
apiVersion: v1
kind: Secret
metadata:
  name: d8-cloud-instance-manager-cloud-provider
  namespace: kube-system
{{ include "helm_lib_module_labels" (list .) | indent 2 }}
type: Opaque
data:
  # obligatory
  type: {{ b64enc "openstack" | quote }}
  zones: {{ .Values.cloudProviderOpenstack.zones | toJson | b64enc | quote }}
  instanceClassKind: {{ b64enc "OpenStackInstanceClass" | quote }}
  machineClassKind: {{ b64enc "OpenStackMachineClass" | quote }}

  # openstack
  {{- $openstackValues := dict }}
  {{- $_ := set $openstackValues "authURL" .Values.cloudProviderOpenstack.authURL }}
  {{- $_ := set $openstackValues "username" .Values.cloudProviderOpenstack.username }}
  {{- $_ := set $openstackValues "password" .Values.cloudProviderOpenstack.password }}
  {{- $_ := set $openstackValues "domainName" .Values.cloudProviderOpenstack.domainName }}
  {{- if hasKey .Values.cloudProviderOpenstack "tenantName" }}
  {{- $_ := set $openstackValues "tenantName" .Values.cloudProviderOpenstack.tenantName }}
  {{- end }}
  {{- if hasKey .Values.cloudProviderOpenstack "tenantID" }}
  {{- $_ := set $openstackValues "tenantID" .Values.cloudProviderOpenstack.tenantID }}
  {{- end }}
  {{- $_ := set $openstackValues "caCert" .Values.cloudProviderOpenstack.caCert }}
  {{- $_ := set $openstackValues "region" .Values.cloudProviderOpenstack.region }}
  {{- $_ := set $openstackValues "networkName" .Values.cloudProviderOpenstack.networkName }}
  {{- $_ := set $openstackValues "internalNetworkName" .Values.cloudProviderOpenstack.internalNetworkName }}
  {{- $_ := set $openstackValues "addPodSubnetToPortWhitelist" .Values.cloudProviderOpenstack.addPodSubnetToPortWhitelist }}
  {{- $_ := set $openstackValues "sshKeyPairName" .Values.cloudProviderOpenstack.sshKeyPairName }}
  {{- $_ := set $openstackValues "securityGroups" .Values.cloudProviderOpenstack.securityGroups }}
  openstack: {{ $openstackValues | toJson | b64enc | quote }}
{{- end }}
