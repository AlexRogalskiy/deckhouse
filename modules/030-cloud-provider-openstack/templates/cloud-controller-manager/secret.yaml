{{- define "openstack_cloud_config" }}
[Global]
auth-url = {{ .Values.cloudProviderOpenstack.authURL | quote }}
domain-name = {{ .Values.cloudProviderOpenstack.domainName | quote }}
{{- if hasKey .Values.cloudProviderOpenstack "tenantName" }}
tenant-name = {{ .Values.cloudProviderOpenstack.tenantName | quote }}
{{- end }}
{{- if hasKey .Values.cloudProviderOpenstack "tenantID" }}
tenant-id = {{ .Values.cloudProviderOpenstack.tenantID | quote }}
{{- end }}
username = {{ .Values.cloudProviderOpenstack.username | quote }}
password = {{ .Values.cloudProviderOpenstack.password | quote }}
region = {{ .Values.cloudProviderOpenstack.region | quote }}
  {{- if .Values.cloudProviderOpenstack.caCert }}
ca-file = /etc/cloud-contoller-manager-config/ca.crt
  {{- end }}
[Networking]
  {{- if and (hasKey .Values.cloudProviderOpenstack "networkName") (hasKey .Values.cloudProviderOpenstack "internalNetworkName") }}
public-network-name = {{ .Values.cloudProviderOpenstack.networkName | quote }}
internal-network-name = {{ .Values.cloudProviderOpenstack.internalNetworkName | quote }}
  {{- end }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: cloud-controller-manager
  namespace: d8-cloud-provider-openstack
{{ include "helm_lib_module_labels" (list . (dict "app" "cloud-controller-manager")) | indent 2 }}
type: Opaque
data:
  cloud-config: {{ include "openstack_cloud_config" . | b64enc | quote }}
  {{- if hasKey .Values.cloudProviderOpenstack "caCert" }}
  ca.crt: {{ .Values.cloudProviderOpenstack.caCert | b64enc | quote }}
{{- end }}
