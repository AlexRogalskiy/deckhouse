---
apiVersion: v1
kind: Secret
metadata:
  name: d8-node-manager-cloud-provider
  namespace: kube-system
{{ include "helm_lib_module_labels" (list .) | indent 2 }}
type: Opaque
data:
  # obligatory
  type: {{ b64enc "yandex" | quote }}
  zones: {{ .Values.cloudProviderYandex.zones | toJson | b64enc | quote }}
  instanceClassKind: {{ b64enc "YandexInstanceClass" | quote }}
  machineClassKind: {{ b64enc "YandexMachineClass" | quote }}

  # Yandex
  {{- $yandexValues := dict }}
  {{- $_ := set $yandexValues "serviceAccountJSON" .Values.cloudProviderYandex.serviceAccountJSON }}
  {{- $_ := set $yandexValues "region" .Values.cloudProviderYandex.region }}
  {{- $_ := set $yandexValues "folderID" .Values.cloudProviderYandex.folderID }}
  {{- $_ := set $yandexValues "sshKey" .Values.cloudProviderYandex.sshKey }}
  {{- $_ := set $yandexValues "sshUser" .Values.cloudProviderYandex.sshUser }}
  {{- if .Values.cloudProviderYandex.dns }}
    {{- $_ := set $yandexValues "dns" dict }}
    {{- $_ := set $yandexValues.dns "nameservers" .Values.cloudProviderYandex.dns.nameservers }}
    {{- $_ := set $yandexValues.dns "search" .Values.cloudProviderYandex.dns.search }}
  {{- end }}
  {{- $_ := set $yandexValues "zoneToSubnetIdMap" .Values.cloudProviderYandex.zoneToSubnetIdMap }}
  yandex: {{ $yandexValues | toJson | b64enc | quote }}
