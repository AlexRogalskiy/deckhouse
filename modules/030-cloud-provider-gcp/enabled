#!/bin/bash

source /deckhouse/shell_lib.sh

function __main__() {
  module::disable_in_kubernetes_versions_less_than 1.15.0

  self_name=cloud-provider-gcp
  if values::get global.enabledModules | jq '.[]' -r | grep -v -E '^'$self_name'$' | grep -E '^cloud-provider-[a-z-]+$' ; then
    >&2 echo "Unable to enable module $self_name: More than one cloud provider is enabled!"
    exit 1
  else
    echo "GCPInstanceClass" > /tmp/cloud-instance-manager-instance-class-kind
    echo "true" > $MODULE_ENABLED_RESULT
  fi
}

hook::run $@
