- name: deckhouse.remove_old_secrets
  rules:
  - alert: D8SecretsFromAntiopaNamespaceShouldBeMigrated
    expr: max(d8_secrets_from_antiopa_namespace_should_be_migrated) > 0
    labels:
      severity_level: "9"
    annotations:
      plk_markup_format: "markdown"
      plk_protocol_version: "1"
      plk_incident_initial_status: "todo"
      sumamry: There are Secrets in the `antiopa` namespace; they must be deleted or moved to the `d8-system` namespace.
      description: |
        There is a Secret in the `antiopa` namespace. You have to either move it to the `d8-system` namespace (it can be used for, e.g., `https.mode: CustomCertificate`) or delete it since the containing namespace will soon be deleted.

        Use the following command to filter for such Secrets:
        `kubectl -n antiopa  get secret -o json  | jq '.items[] | select((.metadata.labels."antiopa-secret-copier" == "yes" | not) and (.metadata.labels."secret-copier.deckhouse.io/enabled" == "" | not) and (.metadata.name|test("default-token.") | not) and (.metadata.name|test("antiopa-token.") | not) and (.metadata.name|test("antiopa-registry") | not)) | .metadata.name' -r`
