matrixTestDefaults:
  internal: &internalDefaults
    clusterMasterAddresses: ["10.0.0.1", "10.0.0.2", "10.0.0.3"]
    clusterCA: myclusterca
    bootstrapToken: mysecrettoken

global:
  enabledModules:
    __ConstantChoices__:
      - ["vertical-pod-autoscaler-crd"]
      - []
  modulesImages:
    registry: registry.flant.com
    registryDockercfg: cfg
    tags:
      cloudInstanceManager:
        clusterAutoscaler: imagehash
        machineControllerManager: imagehash
  discovery:
    clusterMasterCount:
      __ConstantChoices__: ["1", "3"]
    clusterUUID: f49dd1c3-a63a-4565-a06c-625e35587eab
    clusterVersion: 1.15.4

cloudInstanceManager:
  instancePrefix:
    __ConstantChoices__:
    - __EmptyItem__
    - myprefix
  internal:
    __ConstantChoices__:
    - <<: *internalDefaults
      cloudProvider:
        type: aws
        machineClassKind: AWSInstanceClass
        aws:
          providerAccessKeyId: myprovaccesskeyid
          providerSecretAccessKey: myprovsecretaccesskey
          region: myregion
          loadBalancerSecurityGroupID: mylbsecuritygroupid
          keyName: mykeyname
          instances:
            iamProfileName: myiamprofilename
            securityGroupIDs:
              __ConstantChoices__:
              - __EmptyItem__
              - ["mysecgroupid1", "mysecgroupid2"]
            extraTags: ["extratag1", "extratag2"]
          internal:
            zoneToSubnetIdMap:
              zonea: mysubnetida
              zoneb: mysubnetidb
      instanceGroups:
        __ConstantChoices__:
        - []
        - - instanceClass: # maximum
              ami: myami
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.16.6
              diskSizeGb: 50
              diskType: gp2
              iops: 42
              instanceType: t2.medium
            instanceClassReference:
              kind: AWSInstanceClass
              name: worker
            maxInstancesPerZone: 5
            minInstancesPerZone: 3
            name: worker
            zones:
            - zonea
            - zoneb
        - - instanceClass: # minimum
              ami: myami
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.16.6
              instanceType: t2.medium
            instanceClassReference:
              kind: AWSInstanceClass
              name: worker
            maxInstancesPerZone: 1
            minInstancesPerZone: 1
            name: worker
            zones:
            - zonea
    - <<: *internalDefaults
      cloudProvider:
        type: openstack
        machineClassKind: OpenStackMachineClass
        openstack:
          __ConstantChoices__:
          - addPodSubnetToPortWhitelist: true # maximum
            authURL: https://mycloud.qqq/3/
            caCert: mycacert
            domainName: Default
            internalNetworkName: mynetwork
            networkName: shared
            password: pPaAsS
            region: myreg
            securityGroups: [groupa, groupb]
            sshKeyPairName: mysshkey
            internalSubnet: "10.0.0.1/24"
            tenantName: mytname
            username: myuname
          - authURL: https://mycloud.qqq/3/ # minimum
            domainName: Default
            networkName: shared
            password: pPaAsS
            region: myreg
            tenantName: mytname
            username: myuname
      instanceGroups:
        __ConstantChoices__:
        - []
        - - instanceClass: # maximum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
            instanceClassReference:
              kind: OpenStackInstanceClass
              name: worker
            maxInstancesPerZone: 4
            minInstancesPerZone: 2
            name: worker
            zones:
            - zonea
            - zoneb
    - <<: *internalDefaults
      cloudProvider:
        type: gcp
        machineClassKind: GCPMachineClass
        gcp:
          __ConstantChoices__:
          - networkName: mynetwork # maximum
            subnetworkName: mysubnet
            region: myreg
            extraInstanceTags: [aaa,bbb]
            sshKey: mysshkey
            serviceAccountKey: '{"my":"key"}'
            disableExternalIP: true
          - networkName: mynetwork # minimum
            subnetworkName: mysubnet
            region: myreg
            sshKey: mysshkey
            serviceAccountKey: '{"my":"key"}'
      instanceGroups:
        __ConstantChoices__:
        - []
        - - instanceClass: # maximum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
              machineType: mymachinetype
              preemptible: true #optional
              diskType: superdisk #optional
              diskSizeGb: 42 #optional
            instanceClassReference:
              kind: GCPInstanceClass
              name: worker
            maxInstancesPerZone: 4
            minInstancesPerZone: 2
            name: worker
            zones:
            - zonea
            - zoneb
        - - instanceClass: # minimum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
              machineType: mymachinetype
            instanceClassReference:
              kind: GCPInstanceClass
              name: worker
            maxInstancesPerZone: 2
            minInstancesPerZone: 2
            name: worker
            zones:
            - zonea
    - <<: *internalDefaults
      cloudProvider:
        type: vsphere
        machineClassKind: VsphereMachineClass
        vsphere:
          __ConstantChoices__:
          - host: myhost.qqq # maximum
            username: myname
            password: pAsSwOrd
            insecure: true # optional
            regionTagCategory: myregtagcat # optional
            zoneTagCategory: myzonetagcateg # optional
            region: myreg
            sshKeys: [key1, key2] # optional
            vmFolderPath: dev/test
          - host: myhost.qqq # minimum
            username: myname
            password: pAsSwOrd
            region: myreg
            vmFolderPath: dev/test
      instanceGroups:
        __ConstantChoices__:
        - []
        - - instanceClass: # maximum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
              numCPUs: 3
              memory: 3
              rootDiskSize: 42
              template: dev/test
              mainNetwork: mymainnetwork
              additionalNetworks: [aaa, bbb]
              datastore: lun-111
              runtimeOptions: # optional
                nestedHardwareVirtualization: true
                memoryReservation: 42
            instanceClassReference:
              kind: VsphereInstanceClass
              name: worker
            maxInstancesPerZone: 4
            minInstancesPerZone: 2
            name: worker
            zones:
            - zonea
            - zoneb
    - <<: *internalDefaults
      cloudProvider:
        type: yandex
        machineClassKind: YandexMachineClass
        yandex:
          serviceAccountJSON: '{"my":"svcacc"}'
          region: myreg
          folderID: myfolder
          sshKey: mysshkey
          sshUser: mysshuser
          nameservers: ["4.2.2.2"]
          zoneToSubnetIdMap:
            zonea: subneta
            zoneb: subnetb
      instanceGroups:
        __ConstantChoices__:
        - []
        - - instanceClass: # maximum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
              platformID: myplaid
              cores: 42
              coreFraction: 50 #optional
              memory: 42
              gpus: 2
              imageID: myimageid
              preemptible: true #optional
              diskType: ssd #optional
              diskSizeGB: 42 #optional
              assignPublicIPAddress: true #optional
              mainSubnet: mymainsubnet
              additionalSubnets: [aaa, bbb]
              labels: # optional
                my: label
            instanceClassReference:
              kind: YandexInstanceClass
              name: worker
            maxInstancesPerZone: 5
            minInstancesPerZone: 2
            name: worker
            zones:
            - zonea
            - zoneb
        - - instanceClass: # minimum
              bashible:
                bundle: ubuntu-18.04-1.0
                dynamicOptions: {}
                options:
                  kubernetesVersion: 1.15.4
              flavorName: m1.large
              imageName: ubuntu-18-04-cloud-amd64
              platformID: myplaid
              cores: 42
              memory: 42
              gpus: 2
              imageID: myimageid
              mainSubnet: mymainsubnet
              additionalSubnets: [aaa, bbb]
              labels: # optional
                my: label
            instanceClassReference:
              kind: YandexInstanceClass
              name: worker
            maxInstancesPerZone: 1
            minInstancesPerZone: 1
            name: worker
            zones:
            - zonea
            - zoneb
