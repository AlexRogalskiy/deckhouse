kind: AWSClusterConfiguration
apiVersions:
- apiVersion: deckhouse.io/v1
  openAPISpec:
    properties:
      masterNodeGroup:
        description: |
          Спецификация для описания NodeGroup мастера.
        properties:
          replicas:
            description: |
              Сколько мастер-узлов создать.
          instanceClass:
            description: |
              Частичное содержимое полей [AWSInstanceClass]({{"/modules/030-cloud-provider-aws/cr.html#awsinstanceclass" | true_relative_url }}).

              Допустимые параметры:
              * `instanceType`
              * `ami`
              * `additionalSecurityGroups`
              * `diskType`
              * `diskSizeGb`
          zones:
            description: |
              Ограниченный набор зон, в которых разрешено создавать master-узлы. Опциональный параметр.
          additionalTags:
            description: |
              Дополнительные к основным (`AWSClusterConfiguration.tags`) теги, которые будут присвоены созданным инстансам.
      nodeGroups:
        description: |
          Массив дополнительных NodeGroup для создания статичных узлов (например, для выделенных фронтов или шлюзов).
        items:
          properties:
            name:
              description: |
                Имя NodeGroup, будет использоваться для генерации имени узлов.
            replicas:
              description: |
                Количество узлов.
            nodeTemplate:
              description: |
                Настройки Node-объектов в Kubernetes, которые будут добавлены после регистрации узла.
              properties:
                labels:
                  description: |
                    Аналогично стандартному [полю](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#objectmeta-v1-meta) `metadata.labels`.

                    * Пример:

                      ```yaml
                      labels:
                        environment: production
                        app: warp-drive-ai
                      ```
                annotations:
                  description: |
                    Аналогично стандартному [полю](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#objectmeta-v1-meta) `metadata.annotations`.

                    * Пример:

                      ```yaml
                      annotations:
                        ai.fleet.com/discombobulate: "true"
                      ```
                taints:
                  description: |
                    Аналогично полю `.spec.taints` из объекта [Node](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#taint-v1-core). **Внимание!** Доступны только поля `effect`, `key`, `values`.

                    * Пример:

                      ```yaml
                      taints:
                      - effect: NoExecute
                        key: ship-class
                        value: frigate
                      ```
            instanceClass:
              description: |
                Частичное содержимое полей [AWSInstanceClass]({{"/modules/030-cloud-provider-aws/cr.html#awsinstanceclass" | true_relative_url }}).

                Допустимые параметры:
                * `instanceType`
                * `ami`
                * `additionalSecurityGroups`
                * `diskType`
                * `diskSizeGb`
            zones:
              description: |
                Ограниченный набор зон, в которых разрешено создавать узлы. Опциональный параметр.
            additionalTags:
              description: |
                Дополнительные к основным (`AWSClusterConfiguration.tags`) теги, которые будут присвоены созданным инстансам.
      layout:
        description: |
          Название схемы размещения
      vpcNetworkCIDR:
        description: |
          Подсеть, которая будет указана в созданном VPC.

          * обязательный параметр если не указан параметр для развёртывания в уже созданном VPC `existingVPCID`.
      nodeNetworkCIDR:
        description: |
          Подсеть, в которой будут работать узлы кластера.

          * Диапазон должен быть частью или должен соответствовать диапазону адресов VPC.
          * Диапазон будет равномерно разбит на подсети по одной на Availability Zone в вашем регионе.
          * Необязательный, но рекомендованный параметр. По умолчанию — соответствует целому диапазону адресов VPC.

          > Если при создании кластера создаётся новая VPC и не указан `vpcNetworkCIDR`, то VPC будет создана с диапазоном, указанным в `nodeNetworkCIDR`.
          > Таким образом, вся VPC будет выделена под сети кластера и, соответственно, не будет возможности добавить другие ресурсы в эту VPC.
          >
          > Диапазон `nodeNetworkCIDR` распределяется по подсетям в зависимости от количества зон доступности в выбранном регионе. Например,
          > если указана `nodeNetworkCIDR: "10.241.1.0/20"` и в регионе 3 зоны доступности, то подсети будут созданы с маской `/22`.
      existingVPCID:
        description: |
          ID существующего VPC, в котором будет развёрнута схема.

          * Обязательный параметр если не указан `vpcNetworkCIDR`.
          * **Важно!** Если в данной VPC уже есть Internet Gateway, деплой базовой инфраструктуры упадёт с ошибкой. На данный момент адоптнуть Internet Gateway нельзя.
      sshPublicKey:
        description: |
          Публичный ключ для доступа на узлы
      tags:
        description: |
          Теги, которые будут присвоены всем созданным ресурсам. Если поменять теги в рабочем кластере, то после конвержа необходимо пересоздать все машины, чтобы теги применились.
      provider:
        description: |
          Параметры подключения к API AWS.
        properties:
          providerAccessKeyId:
            description: |
              Access key [ID](https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys).
          providerSecretAccessKey:
            description: |
              Access key [secret](https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys).
          region:
            description: |
              Имя AWS региона, в котором будут заказываться instances.
      zones:
        description: |
          Ограничение набора зон, в которых разрешено создавать узлы. Опциональный параметр.
